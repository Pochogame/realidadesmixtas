<!DOCTYPE html>
<html lang="es">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>modelo base</title>
    <style>
        body{
            margin:0;
            overflow: hidden;
            font-family: Arial, Helvetica, sans-serif;
        }
        /* generamos el panel de usuario */
        #panel{
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px;
            background: rgba(0, 131, 0, 0.65);
            border-radius: 12px;
            width: 220px;
            color: #ffffff;
            box-shadow: 0 6px 18px rgba(0,0,0,0.3);
        }
        #panel label{
            font-size: 14px;
            margin-top: 6px;
            display: block;
        }
        #panel input{
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        #panel button{
            width: 100%;
            margin-top: 5px;
            padding: 6px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: rgba(255,255,255,0.08);
            color: #fff;
        }

    </style>
</head>
<body>
    <!--generamos UI-->
    <div id="panel">
        <label>Proyecto</label>
        <select id="projectSelect" style="width:100%; margin-bottom:8px;"></select>
        <button id="loadProject" style="width:100%; margin-bottom:10px;">Cargar proyecto</button>
        <!--panel para cambio de colores del cubo-->
        <label>Color de cubos</label>
        <input type="color" id="cuboColor" value="#FFFFFF">
        <!--panel para cambios de iluminación-->
        <label>Luces</label>
        <input type="range" id="pointLight" min="0" max="3" step="0.1" value="1">
        <!--rotación animación-->
        <label>Animación</label>
        <button id="rotate">Desactivar/activar</button>
    </div>

        <!--librerias-->
        <script src="js/three.min.js"></script>
        <script src="js/GLTFLoader.js"></script>
        <!-- mapear import 'three' usado por módulos a la versión module local -->
        <script type="importmap">
        {
            "imports": {
                "three": "./js/three.module.js"
            }
        }
        </script>
    <!--selector carga dinámica de proyecto -->
    <script>
        (function(){
            var files = ["ar-first.js","ar-final.js","arbolito.js","newmodel.js","parque.js","slime.js"];
            var select = document.getElementById('projectSelect');
            files.forEach(function(f){
                var opt = document.createElement('option');
                opt.value = f;
                opt.textContent = f;
                select.appendChild(opt);
            });
            if(files.indexOf('parque.js')!==-1) select.value = 'parque.js';

            var currentDispose = null;

            function loadProject(name){
                // sanitize name if accidentally contains multiple values (e.g. from weird paste)
                if(typeof name === 'string'){
                    name = name.split(',')[0].trim();
                }
                if(typeof currentDispose === 'function'){
                    try{ currentDispose(); }catch(e){ console.error('Error during dispose', e); }
                    currentDispose = null;
                }

                var existing = document.getElementById('dynamicProject');
                if(existing) existing.parentNode.removeChild(existing);

                var s = document.createElement('script');
                s.id = 'dynamicProject';
                // cargar como módulo para apps que usan import (ajusta si añades más)
                if(name === 'ar-first.js' || name === 'slime.js' || name === 'ar-final.js'){
                    s.type = 'module';
                }
                s.src = 'apps/' + name;
                s.async = false;
                s.onload = function(){
                    if(typeof window.appInit === 'function'){
                        try{
                            window.appInit();
                            currentDispose = (typeof window.appDispose === 'function') ? window.appDispose : null;
                        }catch(e){ console.error('appInit error', e); }
                    } else {
                        currentDispose = (typeof window.appDispose === 'function') ? window.appDispose : null;
                    }
                };
                s.onerror = function(){ console.error('Failed to load', s.src); };
                document.body.appendChild(s);
            }

            document.getElementById('loadProject').addEventListener('click', function(){
                loadProject(select.value);
            });

            select.addEventListener('change', function(){ loadProject(this.value); });

            loadProject(select.value);
            
            // UI bindings: call app-exposed functions if they exist
            function applyUIToApp(){
                var color = document.getElementById('cuboColor').value;
                var intensity = parseFloat(document.getElementById('pointLight').value);
                if(typeof window.setCubeColor === 'function') window.setCubeColor(color);
                if(typeof window.setPointLightIntensity === 'function') window.setPointLightIntensity(intensity);
            }

            document.getElementById('cuboColor').addEventListener('input', function(e){
                var v = e.target.value;
                if(typeof window.setCubeColor === 'function') window.setCubeColor(v);
            });

            document.getElementById('pointLight').addEventListener('input', function(e){
                var val = parseFloat(e.target.value);
                if(typeof window.setPointLightIntensity === 'function') window.setPointLightIntensity(val);
            });

            var rotating = true;
            document.getElementById('rotate').addEventListener('click', function(){
                rotating = !rotating;
                if(typeof window.setRotationEnabled === 'function'){
                    window.setRotationEnabled(rotating);
                } else if(typeof window.toggleRotation === 'function'){
                    window.toggleRotation(rotating);
                }
                this.textContent = rotating ? 'Detener rotación' : 'Activar rotación';
            });
        })();
    </script>
</body>
</html>
